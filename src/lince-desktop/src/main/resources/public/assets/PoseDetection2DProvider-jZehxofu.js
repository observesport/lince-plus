import{B as x}from"./AIStudio-Btt0lsYt.js";import"./index-B3haM2Vf.js";import"./camera-BegOshmH.js";import"./index-DiExZJVg.js";import"./index-C-aM1wJA.js";class P extends x{constructor(i={}){super(i),this.connections=[]}updateConnectionsForModel(i){this.connections=i}updateConfig(i){this.config={...this.config,...i}}renderPoses(i,n,e,s){const t=i.getContext("2d");if(!t||!n.poses||n.poses.length===0)return;i.width=e,i.height=s,t.clearRect(0,0,i.width,i.height);const o=this.video;if(!o)return;const l=e/o.videoWidth,h=s/o.videoHeight;let m=0,d=0;n.poses.forEach((g,y)=>{if(g.keypoints){if(y===0){const c=g.keypoints[0];if(c){const r=c.x>=0&&c.x<=1&&c.y>=0&&c.y<=1;console.log(`Pose coordinates - Normalized: ${r}, Sample:`,{original:{x:c.x,y:c.y},canvas:{width:i.width,height:i.height},video:{width:o.videoWidth,height:o.videoHeight}})}}m+=g.keypoints.length;const N=g.keypoints.map(c=>{let r=c.x,a=c.y;r>=0&&r<=1&&a>=0&&a<=1?(r=r*i.width,a=a*i.height):(r=r*l,a=a*h);const f=c.score||c.visibility||1,p=isNaN(f)?!0:f>this.config.minConfidence,b=!isNaN(r)&&!isNaN(a)&&!(r===0&&a===0);return(!p||!b)&&d++,{...c,x:r,y:a}});this.drawKeypoints(t,N),this.drawSkeleton(t,N),this.config.showBoundingBox&&this.drawBoundingBox(t,N)}}),this.drawDetectionStatus(t,d,e)}drawDetectionStatus(i,n,e){if(n===0)return;const s=Math.min(450,e*.4),t=25,o=`${n} ${n===1?"point":"points"} not detected`;i.font="12px Arial";const l=i.measureText(o).width,h=8;i.fillStyle="rgba(220, 38, 38, 0.9)",i.fillRect(s-h,t-16,l+h*2,20),i.fillStyle="#ffffff",i.textAlign="left",i.fillText(o,s,t)}drawKeypoints(i,n){n.forEach(e=>{const s=e.score||e.visibility||1,t=isNaN(s)?!0:s>this.config.minConfidence,{x:o,y:l}=e,h=!isNaN(o)&&!isNaN(l)&&!(o===0&&l===0);if(t&&h&&(i.beginPath(),i.arc(o,l,this.config.keypointSize,0,2*Math.PI),i.fillStyle=this.config.keypointColor,i.fill(),this.config.showKeypointLabels)){i.fillStyle=this.config.keypointLabelColor,i.font=`${this.config.keypointLabelSize}px Arial`,i.textAlign="center";const m=e.name||e.part||`Point ${n.indexOf(e)}`;i.fillText(m,o,l-this.config.keypointSize-5)}})}drawSkeleton(i,n){i.strokeStyle=this.config.skeletonColor,i.lineWidth=this.config.skeletonThickness,this.connections.forEach(([e,s])=>{if(e>=0&&e<n.length&&s>=0&&s<n.length){const t=n[e],o=n[s],l=t?.score||t?.visibility||1,h=o?.score||o?.visibility||1,m=isNaN(l)?!0:l>this.config.minConfidence,d=isNaN(h)?!0:h>this.config.minConfidence,g=!isNaN(t?.x)&&!isNaN(t?.y)&&!(t?.x===0&&t?.y===0),y=!isNaN(o?.x)&&!isNaN(o?.y)&&!(o?.x===0&&o?.y===0);t&&o&&m&&d&&g&&y&&(i.beginPath(),i.moveTo(t.x,t.y),i.lineTo(o.x,o.y),i.stroke())}})}drawBoundingBox(i,n){const e=n.filter(f=>{const p=f.score||f.visibility||1;return!isNaN(p)&&p>this.config.minConfidence&&!isNaN(f.x)&&!isNaN(f.y)});if(e.length===0)return;const s=e.map(f=>f.x),t=e.map(f=>f.y),o=Math.min(...s),l=Math.max(...s),h=Math.min(...t),m=Math.max(...t),d=10,g=o-d,y=l+d,N=h-d,c=m+d,r=y-g,a=c-N;i.strokeStyle=this.config.boundingBoxColor,i.lineWidth=this.config.boundingBoxThickness,i.strokeRect(g,N,r,a)}}export{P as PoseDetection2DProvider};
