import{cX as p}from"./index-Cp-dRVR4.js";class w extends p{constructor(i={}){super(i),this.connections=[]}updateConnectionsForModel(i){this.connections=i}updateConfig(i){this.config={...this.config,...i}}renderPoses(i,s,n,e){const o=i.getContext("2d");if(!o||!s.poses||s.poses.length===0)return;i.width=n,i.height=e,o.clearRect(0,0,i.width,i.height);const t=this.video;if(!t)return;const c=n/t.videoWidth,l=e/t.videoHeight;let g=0,h=0;s.poses.forEach((d,y)=>{if(d.keypoints){g+=d.keypoints.length;const m=d.keypoints.map(N=>{let a=N.x,f=N.y;a>=0&&a<=1&&f>=0&&f<=1?(a=a*i.width,f=f*i.height):(a=a*c,f=f*l);const r=N.score||N.visibility||1,b=isNaN(r)?!0:r>this.config.minConfidence,u=!isNaN(a)&&!isNaN(f)&&!(a===0&&f===0);return(!b||!u)&&h++,{...N,x:a,y:f}});this.drawKeypoints(o,m),this.drawSkeleton(o,m),this.config.showBoundingBox&&this.drawBoundingBox(o,m)}}),this.drawDetectionStatus(o,h,n)}drawDetectionStatus(i,s,n){if(s===0)return;const e=Math.min(450,n*.4),o=25,t=`${s} ${s===1?"point":"points"} not detected`;i.font="12px Arial";const c=i.measureText(t).width,l=8;i.fillStyle="rgba(220, 38, 38, 0.9)",i.fillRect(e-l,o-16,c+l*2,20),i.fillStyle="#ffffff",i.textAlign="left",i.fillText(t,e,o)}drawKeypoints(i,s){s.forEach(n=>{const e=n.score||n.visibility||1,o=isNaN(e)?!0:e>this.config.minConfidence,{x:t,y:c}=n,l=!isNaN(t)&&!isNaN(c)&&!(t===0&&c===0);if(o&&l&&(i.beginPath(),i.arc(t,c,this.config.keypointSize,0,2*Math.PI),i.fillStyle=this.config.keypointColor,i.fill(),this.config.showKeypointLabels)){i.fillStyle=this.config.keypointLabelColor,i.font=`${this.config.keypointLabelSize}px Arial`,i.textAlign="center";const g=n.name||n.part||`Point ${s.indexOf(n)}`;i.fillText(g,t,c-this.config.keypointSize-5)}})}drawSkeleton(i,s){i.strokeStyle=this.config.skeletonColor,i.lineWidth=this.config.skeletonThickness,this.connections.forEach(([n,e])=>{if(n>=0&&n<s.length&&e>=0&&e<s.length){const o=s[n],t=s[e],c=o?.score||o?.visibility||1,l=t?.score||t?.visibility||1,g=isNaN(c)?!0:c>this.config.minConfidence,h=isNaN(l)?!0:l>this.config.minConfidence,d=!isNaN(o?.x)&&!isNaN(o?.y)&&!(o?.x===0&&o?.y===0),y=!isNaN(t?.x)&&!isNaN(t?.y)&&!(t?.x===0&&t?.y===0);o&&t&&g&&h&&d&&y&&(i.beginPath(),i.moveTo(o.x,o.y),i.lineTo(t.x,t.y),i.stroke())}})}drawBoundingBox(i,s){const n=s.filter(r=>{const b=r.score||r.visibility||1;return!isNaN(b)&&b>this.config.minConfidence&&!isNaN(r.x)&&!isNaN(r.y)});if(n.length===0)return;const e=n.map(r=>r.x),o=n.map(r=>r.y),t=Math.min(...e),c=Math.max(...e),l=Math.min(...o),g=Math.max(...o),h=10,d=t-h,y=c+h,m=l-h,N=g+h,a=y-d,f=N-m;i.strokeStyle=this.config.boundingBoxColor,i.lineWidth=this.config.boundingBoxThickness,i.strokeRect(d,m,a,f)}}export{w as PoseDetection2DProvider};
